import{j as e,E as fe,q as pe,v as ge,w as be,u as te,b as p,r as l,x as je,y as ye,C as O,t as j,z as we,e as ve,a as Ne,A as Se,B as Ae,D as V,F as Z,G as ee,H as Ce,o as ke,p as Pe}from"./index-Bq32TEZ8.js";import{U as _e,L as se}from"./UserLayout-yuTYACIF.js";import{U as Ie}from"./UserHeader-qhcX_yJu.js";import{S as $e}from"./SongList-CIZ81_nY.js";import{A as Re,R as Me}from"./AlbumCard-B1j6kRLN.js";import{a as re}from"./index-BB54KNlg.js";import{f as Fe}from"./artistsSelectors-BMpZxlMU.js";import{f as Ue}from"./index-DsaIwXDl.js";import{O as Be}from"./OneTimePaymentModal-Trly3YgJ.js";import{s as Ee,a as De,b as Le}from"./albumsSelector-BPwziAEI.js";import{s as ze,S as Ye,a as c}from"./index-rtsjbbxS.js";/* empty css                 */import"./IconHeader-BhAI_0tO.js";import"./assets-Dbh41_OJ.js";import"./iconBase-Cst9Bakk.js";import"./index-B6qKfaA3.js";import"./index-BLpoeeon.js";const Te=({artist:a,isSubscribed:i,subscriptionLoading:o,subscriptionPrice:d,handleSubscribe:x,getArtistColor:u})=>{const g=u(a==null?void 0:a.name);return e.jsx("div",{className:"mt-12 flex flex-col md:flex-row gap-6 px-6 pb-12 text-white",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full h-72 md:w-1/4",children:a.image?e.jsx("img",{src:a.image,alt:"Artist",className:"w-full h-full object-cover border-t-4 border-b-4 border-blue-600"}):e.jsx("div",{className:`w-full h-full ${g} flex items-center justify-center text-white text-8xl font-bold border-t-4 border-b-4 border-blue-600`,children:a.name?a.name.charAt(0).toUpperCase():"A"})}),e.jsxs("div",{className:"w-full md:w-2/3 bg-white/5 backdrop-blur-sm p-6 rounded-md shadow-lg border border-white/10",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-blue-400 text-xl font-bold",children:[e.jsx("span",{className:"text-blue-500 text-2xl lowercase",children:"about"}),e.jsx("span",{className:"text-white capitalize",children:(a==null?void 0:a.name)||"Unknown"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-300 mb-4",children:[e.jsx(re,{className:"text-blue-500"}),e.jsxs("span",{children:[(a==null?void 0:a.location)||"Unknown Location"," •"," ",(a==null?void 0:a.birthYear)||"N/A"]})]}),e.jsxs("p",{className:"text-sm text-gray-300 leading-relaxed",children:[(a==null?void 0:a.bio)||"This artist has not provided a biography yet."," ",e.jsx("span",{className:"text-blue-400 cursor-pointer hover:underline",children:"View more"})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-400 mb-2",children:"Subscription Details"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:i?e.jsx("span",{className:"text-green-400",children:"✓ You are subscribed"}):"Subscribe for exclusive content"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["$",d.toFixed(2)," per month • Cancel anytime"]})]}),e.jsx("button",{onClick:x,disabled:o,className:`px-4 py-2 rounded-full text-sm font-medium transition-all ${i?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-blue-600 text-white hover:bg-blue-700"} ${o?"opacity-70 cursor-not-allowed":""}`,children:o?"Processing...":i?"Manage Subscription":"Subscribe Now"})]})]})]})]}):e.jsxs("div",{className:"w-full flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx("div",{className:"bg-gray-700 h-72 w-full rounded-md animate-pulse"})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsx("div",{className:"bg-gray-700 h-72 w-full rounded-md animate-pulse"})})]})})},He=pe("pk_test_51Kr3X3SJADrx40al3R8tFGDrAXJPHUKWYXdV5hDRYRG8Mld4FRaJ7fRozKbYxeUShBinMsfXCWNrj20OAgfojcme0093XF6ijY"),Oe=({artistId:a,onCardSaved:i,onClose:o})=>{const d=ge(),x=be(),u=te(),{clientSecret:g,loading:M,error:B}=p(b=>b.payment),[w,v]=l.useState(!1),[h,f]=l.useState(""),[r,N]=l.useState("");l.useEffect(()=>(u(je()),()=>u(ye())),[u]),l.useEffect(()=>{if(!x)return;const b=x.getElement(O);b&&b.on("change",S=>{var m;S.complete?(f(S.brand||""),N(((m=S.value)==null?void 0:m.last4)||"")):(f(""),N(""))})},[x]);const P=async b=>{if(b.preventDefault(),!d||!x||!g)return;v(!0);const S=x.getElement(O),{error:m,setupIntent:A}=await d.confirmCardSetup(g,{payment_method:{card:S}});if(m){j.error("Card setup failed: "+m.message),v(!1);return}const _=A.payment_method;try{const I=await u(we({artistId:a,paymentMethodId:_})).unwrap();if(I.clientSecret){const E=await d.confirmCardPayment(I.clientSecret,{payment_method:_});if(E.error){j.error("Payment failed: "+E.error.message),v(!1);return}}j.success("Subscription successful!"),i==null||i(),o==null||o()}catch(I){j.error("Subscription failed. "+(I.message||""))}finally{v(!1)}};return M?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-400"})}):B?e.jsx("div",{className:"text-red-400 text-sm p-4 text-center",children:"Failed to initialise payment. Please try again later."}):e.jsxs("form",{onSubmit:P,className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-green-400",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),e.jsx("span",{children:"Your card details are encrypted & never stored by us"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Card Details"}),e.jsx("div",{className:"bg-gray-800 p-3 rounded-lg border border-gray-700 focus-within:border-indigo-500 transition",children:e.jsx(O,{options:{style:{base:{fontSize:"16px",color:"#f3f4f6","::placeholder":{color:"#9ca3af"},iconColor:"#6366f1"},invalid:{color:"#f87171"}},hidePostalCode:!0}})}),h&&r&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[h.toUpperCase()," •••• ",r]})]}),e.jsx("p",{className:"text-xs text-gray-400",children:"We will only charge you after confirming your subscription. Your card is saved securely with Stripe."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:o,disabled:w,className:"px-5 py-2.5 text-sm font-medium text-gray-300 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:w,className:"px-5 py-2.5 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors disabled:opacity-50 flex items-center",children:w?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing…"]}):"Save Card & Subscribe"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-4",children:["Secured by"," ",e.jsx("a",{href:"https://stripe.com",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-gray-300",children:"Stripe"})]})]})},Ve=({artistId:a,onCardSaved:i,onClose:o})=>e.jsxs("div",{className:"fixed inset-0 bg-gradient-to-br from-gray-900/90 via-black/80 to-black/90 backdrop-blur-sm flex justify-center items-center z-50 p-4 animate-fadeIn",onClick:o,children:[e.jsxs("div",{className:"bg-gray-900/95 border border-gray-700/60 rounded-2xl shadow-2xl max-w-md w-full p-6 animate-slideUp",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Add Payment Method"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Secure subscription via Stripe"})]}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-200 transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(fe,{stripe:He,children:e.jsx(Oe,{artistId:a,onCardSaved:i,onClose:o})})})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
      `})]}),cs=()=>{const{artistId:a}=ve(),i=te(),o=l.useRef(null),d=l.useRef(null),[x,u]=l.useState(!1),[g,M]=l.useState(null),[B,w]=l.useState(null),v=Ne(),h=p(s=>s.player.selectedSong),f=p(s=>s.auth.user),r=p(Fe),N=p(Ee),P=p(De);p(Le);const b=p(s=>ze(s,a),Se),m=p(s=>s.userDashboard.subscriptions||[]).some(s=>s.artist.slug===a),[A,_]=l.useState(!1),[I,E]=l.useState(!1),[ae,D]=l.useState(!1),{songs:y=[],pages:L=1,status:$="idle"}=b||{},[C,le]=l.useState(1),[z,ie]=l.useState(1),[R,W]=l.useState("idle"),[k,ne]=l.useState(!0),[Y,oe]=l.useState(!1),F=l.useRef(),U=l.useRef(),X=s=>{if(!s)return"bg-blue-600";const t=["bg-blue-600","bg-purple-600","bg-pink-600","bg-red-600","bg-orange-600","bg-yellow-600","bg-green-600","bg-teal-600","bg-indigo-600"],n=s.split("").reduce((ue,he)=>he.charCodeAt(0)+ue,0);return t[n%t.length]};l.useEffect(()=>{a&&(i(Ae(a)),i(V()),i(Z({artistId:a,page:1,limit:10})),i(ee({artistId:a,page:1,limit:10})))},[i,a]);const ce=async s=>{if(R!=="loading"){W("loading");try{await i(Z({artistId:a,page:s,limit:10})).unwrap(),s>=P.totalPages&&ne(!1)}catch(t){console.error("Failed to fetch albums:",t)}finally{W("idle")}}};l.useEffect(()=>{z>1&&k&&ce(z)},[z,k]),l.useEffect(()=>{a&&C>1&&i(ee({artistId:a,page:C,limit:10}))},[i,a,C]);const q=s=>{i(ke(s)),i(Pe())},G=s=>{var t;(t=s==null?void 0:s.current)==null||t.scrollBy({left:200,behavior:"smooth"})},J=async()=>{if(!(r!=null&&r._id)){j.error("Artist info not loaded.");return}if(m){if(!window.confirm(`Are you sure you want to unsubscribe from ${r.name}?`))return;_(!0);try{await Ce.delete(`/subscriptions/artist/${r._id}`),i(V()),j.success(`Unsubscribed from ${r.name}`)}catch(t){j.error("Failed to unsubscribe"),console.error(t)}finally{_(!1)}}else D(!0)},K=(s,t)=>{M(s),w(t),u(!0)},de=l.useCallback(s=>{$!=="loading"&&(F.current&&F.current.disconnect(),F.current=new IntersectionObserver(t=>{t[0].isIntersecting&&C<L&&le(n=>n+1)}),s&&F.current.observe(s))},[$,C,L]);l.useCallback(s=>{R==="loading"||!k||(U.current&&U.current.disconnect(),U.current=new IntersectionObserver(t=>{t[0].isIntersecting&&k&&ie(n=>n+1)}),s&&U.current.observe(s))},[R,k]);const me=Y?y:y.slice(0,5),T=(r==null?void 0:r.subscriptionPrice)||4.99,H=X(r==null?void 0:r.name),xe=(s,t,n="w-20 h-20")=>s?e.jsx("img",{src:s,alt:t||"Artist",className:`${n} rounded-full object-cover border-2 border-blue-500 shadow-[0_0_5px_1px_#3b82f6]`}):e.jsx("div",{className:`${n} ${H} rounded-full flex items-center justify-center text-white font-bold text-xl border-2 border-blue-500 shadow-[0_0_5px_1px_#3b82f6]`,children:t?t.charAt(0).toUpperCase():"A"}),Q=(s,t,n="w-full h-full")=>s?e.jsx("img",{src:s,alt:t||"Cover",className:`${n} object-cover`}):e.jsx("div",{className:`${n} ${H} flex items-center justify-center text-white font-bold text-2xl`,children:t?t.charAt(0).toUpperCase():"C"});return e.jsxs(_e,{children:[e.jsx(Ie,{}),e.jsxs(Ye,{baseColor:"#1f2937",highlightColor:"#374151",children:[e.jsx("div",{className:"relative h-80 w-full",children:r?e.jsxs(e.Fragment,{children:[r.image?e.jsx("img",{src:r.image,className:"w-full h-full object-cover opacity-80",alt:"Artist Background"}):e.jsx("div",{className:`w-full h-full ${H} opacity-80`}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-20 bg-gradient-to-b from-[#0f172a] to-transparent z-20"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-900/30 to-blue-900/30 z-10"}),e.jsxs("div",{className:"absolute bottom-8 left-8 z-30 flex items-center gap-6 text-white",children:[xe(r==null?void 0:r.image,r==null?void 0:r.name),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm lowercase tracking-widest text-gray-200",children:"Artist"}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mt-1",children:(r==null?void 0:r.name)||"Unknown Artist"}),e.jsxs("div",{className:"flex items-center mt-1 text-gray-300 text-sm",children:[e.jsx(re,{className:"mr-2 text-blue-600"}),e.jsx("span",{children:(r==null?void 0:r.location)||"Unknown City"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[e.jsxs("span",{className:"text-lg font-semibold text-blue-400",children:["₹",T.toFixed(2),"/month"]}),e.jsx("button",{onClick:J,disabled:A,className:`px-5 py-2 rounded-full text-sm font-semibold transition-all duration-200 shadow-md
                        ${A?"opacity-70 cursor-not-allowed":""}
                        ${m?"bg-red-600 text-white hover:bg-red-700":"bg-blue-600 text-white hover:bg-blue-700"}`,children:A?"Processing...":m?"Cancel Subscription":`Subscribe ₹${T.toFixed(2)}/mo`})]})]})]})]}):e.jsx("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center",children:e.jsx(c,{width:200,height:40})})}),e.jsxs("div",{className:"flex justify-between mt-6 px-6 text-lg text-white",children:[e.jsx("h2",{children:"All Songs"}),y.length>5&&e.jsx("button",{className:"text-blue-500 cursor-pointer hover:underline",onClick:()=>oe(!Y),children:Y?"Show less":"See all"})]}),e.jsx("div",{className:"px-6 py-4 flex flex-col gap-4",children:$==="loading"&&y.length===0?[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{circle:!0,width:50,height:50}),e.jsxs("div",{className:"flex-1",children:[e.jsx(c,{width:120,height:16}),e.jsx(c,{width:80,height:12})]}),e.jsx(c,{width:40,height:16})]},`song-skeleton-${t}`)):e.jsxs(e.Fragment,{children:[me.map(s=>e.jsx($e,{songId:s._id,img:s.coverImage?s.coverImage:Q(null,s.title,"w-12 h-12"),songName:s.title,singerName:s.singer,seekTime:Ue(s.duration),onPlay:()=>q(s),isSelected:(h==null?void 0:h._id)===s._id},s._id)),$==="loading"&&C<L&&[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{circle:!0,width:50,height:50}),e.jsxs("div",{className:"flex-1",children:[e.jsx(c,{width:120,height:16}),e.jsx(c,{width:80,height:12})]}),e.jsx(c,{width:40,height:16})]},`song-loading-${t}`))]})}),e.jsxs("div",{className:"flex justify-between mt-6 px-6 text-lg text-white items-center",children:[e.jsx("h2",{children:"Albums"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:["Page ",P.page," of ",P.totalPages]}),e.jsx(se,{className:"text-white cursor-pointer hover:text-blue-800 text-2xl",onClick:()=>G(o)})]})]}),e.jsx("div",{className:"px-6 py-2",children:e.jsx("div",{ref:o,className:"flex gap-4 overflow-x-auto pb-2 no-scrollbar whitespace-nowrap min-h-[220px]",children:R==="loading"&&N.length===0?[...Array(5)].map((s,t)=>e.jsxs("div",{className:"min-w-[160px]",children:[e.jsx(c,{height:160,width:160,className:"rounded-xl"}),e.jsx(c,{width:120,height:16,className:"mt-2"})]},`album-skeleton-${t}`)):N.length>0?e.jsxs(e.Fragment,{children:[N.map(s=>{var t,n;return e.jsx(Re,{tag:`#${s.title||"music"}`,artists:((t=s.artist)==null?void 0:t.name)||"Various Artists",image:s.coverImage||"/images/placeholder.png",price:s.price===0?"subs..":(n=f==null?void 0:f.purchasedAlbums)!=null&&n.includes(s._id)?"Purchased":e.jsxs("button",{className:"bg-indigo-600 hover:bg-indigo-700 text-white text-xs px-2 py-1 rounded",onClick:()=>K(s,"album"),children:["Buy for $",s.price]}),onClick:()=>v(`/album/${s.slug}`)},s._id)}),R==="loading"&&k&&[...Array(2)].map((s,t)=>e.jsxs("div",{className:"min-w-[160px]",children:[e.jsx(c,{height:160,width:160,className:"rounded-xl"}),e.jsx(c,{width:120,height:16,className:"mt-2"})]},`album-loading-${t}`))]}):e.jsx("p",{className:"text-white text-sm",children:"No albums found."})})}),e.jsxs("div",{className:"flex justify-between mt-6 px-6 text-lg text-white items-center",children:[e.jsx("h2",{children:"Singles"}),e.jsx(se,{className:"text-white cursor-pointer hover:text-blue-800 text-2xl",onClick:()=>G(d)})]}),e.jsx("div",{ref:d,className:"flex gap-4 overflow-x-auto px-6 py-2 no-scrollbar min-h-[160px]",children:$==="loading"&&y.length===0?[...Array(5)].map((s,t)=>e.jsxs("div",{className:"min-w-[160px]",children:[e.jsx(c,{height:160,width:160,className:"rounded-xl"}),e.jsx(c,{width:120,height:16,className:"mt-2"})]},`single-skeleton-${t}`)):y.map((s,t)=>{var n;return e.jsx(Me,{ref:t===y.length-1?de:null,title:s.title,singer:s.singer,image:s.coverImage?s.coverImage:Q(null,s.title,"w-full h-40"),onPlay:()=>q(s),isSelected:(h==null?void 0:h._id)===s._id,price:s.accessType==="purchase-only"?(n=f==null?void 0:f.purchasedSongs)!=null&&n.includes(s._id)?"Purchased":e.jsxs("button",{className:"bg-indigo-600 hover:bg-indigo-700 text-white text-xs px-2 py-1 rounded",onClick:()=>K(s,"song"),children:["Buy for $",s.price]}):"Subs.."},s._id)})}),e.jsx(Te,{artist:r,isSubscribed:m,subscriptionLoading:A,subscriptionPrice:T,handleSubscribe:J,getArtistColor:X}),ae&&e.jsx(Ve,{artistId:r==null?void 0:r._id,onCardSaved:()=>{D(!1),i(V()),j.success(`Subscribed to ${r==null?void 0:r.name}`)},onClose:()=>D(!1)}),x&&g&&e.jsx(Be,{itemType:B,itemId:g._id,amount:g.price,onClose:()=>{u(!1),M(null),w(null)}})]})]})};export{cs as default};
